jQuery(document).ready(function(e){"use strict";var l=e(document).find(".ywarc_new_rules"),a=e(document).find(".ywarc_rules_group"),r=e("#yith_ywarc_add_rule_button"),c=e(".ywarc_new_rule_title"),n=e(".ywarc_creating_rule");function _(r,c){var n=e(r),_=n.data("rule_id"),i=n.find(".rule_head"),t=n.find(".rule_options"),d=i.find("label.rule_title").text();c&&(l.append(n),t.show(),o()),i.on("click",function(e){t.slideToggle()}),n.trigger("init_tooltips");var u=t.find("div.rule_type_block"),s=t.find("div.role_selector_block");s.hide();var f=t.find("div.replace_role_block");f.hide();var p=t.find("div.specific_product_block");p.hide();var y,m=t.find("div.submit_block"),w=function(e){"role_selector"!=e&&"all"!=e||s.removeClass("empty_field"),"product_selector"!=e&&"all"!=e||p.removeClass("empty_field")};t.find("input.ywarc_rule_type_radio_button").change(function(){var e=t.find("input.ywarc_rule_type_radio_button:checked");"add"==e.val()?(f.hide(),s.slideDown(),p.slideDown()):"replace"==e.val()&&(f.slideDown(),s.hide(),p.slideDown())}).change(),y=localize_js_ywarc_admin.before_2_7?{maximumSelectionSize:1}:{maximumSelectionLength:1},t.find(".ywarc_role_selector, .ywarc_replace_role_before, .ywarc_replace_role_after").select2(y).on("change",function(){w("role_selector")}),e(document.body).trigger("wc-enhanced-select-init"),e(":input.wc-product-search").on("change",function(){w("product_selector")}),m.find("input").on("click",function(l){l.preventDefault(),n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var r=u.find("input.ywarc_rule_type_radio_button:checked").val(),i=s.find("select.ywarc_role_selector").val(),y=f.find("select.ywarc_replace_role_before").val(),m=f.find("select.ywarc_replace_role_after").val(),w=p.find(':input[id^="ywarc_product_selector"]').val(),v=!0;if("add"===r?i||(v=!1,s.addClass("empty_field")):"replace"===r?y&&m||(v=!1,f.addClass("empty_field")):(v=!1,u.addClass("empty_field")),w||(v=!1,p.addClass("empty_field")),v){var k={action:"ywarc_save_rule",title:d,rule_id:_,rule_type:r,role_selected:i,replace_roles:y&&m?[y,m]:"",product_selected:w};e.post(localize_js_ywarc_admin.ajax_url,k,function(l){n.unblock(),c&&(a.append(n),t.hide(),c=!1),a.find(".rule_block").length>0&&e("#my_rules_header").removeClass("no_rules"),o()})}else n.unblock();o()}),m.find("a.delete_rule").on("click",function(l){if(l.preventDefault(),1==confirm(localize_js_ywarc_admin.delete_rule_msg)){if(c)n.remove();else{n.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var r={action:"ywarc_delete_rule",rule_id:_};e.post(localize_js_ywarc_admin.ajax_url,r,function(l){n.unblock(),n.remove(),0==a.find(".rule_block").length&&e("#my_rules_header").addClass("no_rules")})}0==a.find(".rule_block").length&&e("#my_rules_header").addClass("no_rules")}o()})}function o(){l.find(".rule_block").length>0?e("#ywarc_new_rules_row").removeClass("no_rules"):e("#ywarc_new_rules_row").addClass("no_rules")}c.focus(),c.keydown(function(e){13==e.which&&(r.focus(),r.trigger("click"))}),r.on("click",function(a){a.preventDefault();var r=c.val().trim(),o=[];l.find(".rule_title").each(function(){o.push(e(this).text())}),"-1"!=e.inArray(r,o)?(alert(localize_js_ywarc_admin.duplicated_name_msg),c.val(""),c.focus()):""==r?(alert(localize_js_ywarc_admin.empty_name_msg),c.focus()):(n.block({message:null,overlayCSS:{background:"#f1f1f1",opacity:.6}}),e.post(localize_js_ywarc_admin.ajax_url,{action:"ywarc_add_rule",title:r},function(e){n.unblock(),c.val(""),"duplicated_name_error"===e?(alert(localize_js_ywarc_admin.duplicated_name_msg),c.focus()):_(e,!0)}))}),e(".rule_block").each(function(e,l){_(l,!1)}),e("#show_all_rules").on("click",function(e){e.preventDefault(),a.find(".rule_options").slideDown()}),e("#hide_all_rules").on("click",function(e){e.preventDefault(),a.find(".rule_options").slideUp()}),e("#delete_all_rules").on("click",function(l){l.preventDefault(),1==confirm(localize_js_ywarc_admin.delete_all_rules_msg)&&(n.block({message:null,overlayCSS:{background:"#f1f1f1",opacity:.6}}),e.post(localize_js_ywarc_admin.ajax_url,{action:"ywarc_delete_all_rules"},function(l){n.unblock(),a.find(".rule_block").remove(),e("#my_rules_header").addClass("no_rules")})),o()})});